<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QuickBill Invoice Generator</title>
  <style>
    body {
      background-color: #e6f0ff;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
    }
    input, textarea, select {
      width: 100%;
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    .section {
      margin-top: 20px;
    }
    #invoicePreview {
      margin-top: 20px;
      padding: 10px;
      border: 1px dashed #666;
      background: #f9f9f9;
    }
    #logoPreview img {
      max-width: 150px;
    }
    .btn {
      padding: 10px 15px;
      margin-right: 10px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .btn-secondary {
      background-color: #28a745;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>QuickBill Invoice Generator</h1>
    <div class="section">
      <h3>Business Details</h3>
      <input type="text" id="bizName" placeholder="Business Name">
      <input type="text" id="kraPin" placeholder="KRA PIN (Optional)">
      <input type="file" id="logoUpload">
      <div id="logoPreview"></div>
    </div>

    <div class="section">
      <h3>Customer Details</h3>
      <input type="text" id="custName" placeholder="Customer Name">
      <input type="text" id="custEmail" placeholder="Customer Email">
      <input type="text" id="custPhone" placeholder="Customer Phone">
    </div>

    <div class="section">
      <h3>Invoice Items</h3>
      <textarea id="items" placeholder="Item name, quantity, unit price\nExample:\nApples,2,100\nBananas,5,60"></textarea>
      <input type="number" id="taxRate" placeholder="Tax Rate (e.g. 16 for 16%)">
      <button class="btn" onclick="generateInvoice()">Preview Invoice</button>
    </div>

    <div id="invoicePreview"></div>

    <div class="section">
      <button class="btn" onclick="exportExcel()">Download Excel (Free)</button>
      <button class="btn btn-secondary" onclick="exportPDF()">Download PDF (Premium Only)</button>
    </div>
  </div>

  <script>
    let logoData = '';
    document.getElementById('logoUpload').addEventListener('change', function(e) {
      const reader = new FileReader();
      reader.onload = function(e) {
        logoData = e.target.result;
        document.getElementById('logoPreview').innerHTML = `<img src="${logoData}" alt="Logo">`;
      }
      reader.readAsDataURL(e.target.files[0]);
    });

    function generateInvoice() {
      const items = document.getElementById('items').value.trim().split('\n');
      const tax = parseFloat(document.getElementById('taxRate').value) || 0;
      let html = `<div>${logoData ? `<img src='${logoData}' alt='Logo'><br>` : ''}`;
      html += `<strong>${document.getElementById('bizName').value}</strong><br>`;
      html += `KRA PIN: ${document.getElementById('kraPin').value}<br><br>`;

      html += `<strong>Bill To:</strong><br>${document.getElementById('custName').value}<br>${document.getElementById('custEmail').value}<br>${document.getElementById('custPhone').value}<br><br>`;

      html += `<table border='1' width='100%' cellpadding='5'><tr><th>Item</th><th>Qty</th><th>Unit</th><th>Total</th></tr>`;
      let subtotal = 0;
      items.forEach(row => {
        const [item, qty, price] = row.split(',');
        const lineTotal = parseFloat(qty) * parseFloat(price);
        subtotal += lineTotal;
        html += `<tr><td>${item}</td><td>${qty}</td><td>${price}</td><td>${lineTotal}</td></tr>`;
      });
      const taxAmt = (subtotal * tax) / 100;
      const total = subtotal + taxAmt;
      html += `</table><br><strong>Subtotal:</strong> ${subtotal}<br><strong>Tax (${tax}%):</strong> ${taxAmt}<br><strong>Total:</strong> ${total}</div>`;
      document.getElementById('invoicePreview').innerHTML = html;
    }

    function exportExcel() {
      alert("Excel export includes watermark and totals. Feature coming in .zip version.");
    }

    function exportPDF() {
      alert("PDF export available for premium users only.");
    }
  </script>
</body>
</html>
