<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quick Bill</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: auto; padding: 1em; }
    table, th, td { border: 1px solid black; border-collapse: collapse; padding: 8px; }
    input { width: 100px; }
    .btn { padding: 10px 15px; margin: 5px; cursor: pointer; }
  </style>
</head>
<body>

  <h1>Quick Bill - Invoice Generator</h1>
  
  <table id="invoiceTable">
    <thead>
      <tr>
        <th>Item</th><th>Qty</th><th>Price</th><th>Total</th>
      </tr>
    </thead>
    <tbody id="invoiceBody">
      <tr>
        <td><input type="text" value="Item 1" /></td>
        <td><input type="number" value="1" /></td>
        <td><input type="number" value="100" /></td>
        <td class="item-total">100</td>
      </tr>
    </tbody>
  </table>
  
  <button class="btn" onclick="addRow()">+ Add Item</button>
  
  <h3>Tax (%): <input id="taxInput" type="number" value="16" /></h3>
  
  <h3>Subtotal: <span id="subtotal">0</span></h3>
  <h3>Total (with tax): <span id="totalWithTax">0</span></h3>
  
  <button class="btn" onclick="calculateTotals()">Recalculate</button>
  <button class="btn" onclick="downloadExcel()">Download Excel</button>
  <button class="btn" onclick="downloadPDF()">Download PDF</button>

  <script>
    function addRow() {
      const table = document.getElementById("invoiceBody");
      const row = table.insertRow();
      row.innerHTML = `
        <td><input type="text" /></td>
        <td><input type="number" value="1" /></td>
        <td><input type="number" value="0" /></td>
        <td class="item-total">0</td>
      `;
    }

    function calculateTotals() {
      const rows = document.querySelectorAll("#invoiceBody tr");
      let subtotal = 0;
      rows.forEach(row => {
        const qty = parseFloat(row.cells[1].querySelector("input").value) || 0;
        const price = parseFloat(row.cells[2].querySelector("input").value) || 0;
        const total = qty * price;
        row.cells[3].textContent = total.toFixed(2);
        subtotal += total;
      });

      const taxRate = parseFloat(document.getElementById("taxInput").value) || 0;
      const totalWithTax = subtotal + (subtotal * taxRate / 100);

      document.getElementById("subtotal").textContent = subtotal.toFixed(2);
      document.getElementById("totalWithTax").textContent = totalWithTax.toFixed(2);
    }

    function downloadExcel() {
      calculateTotals();
      const wb = XLSX.utils.book_new();
      const ws_data = [["Item", "Qty", "Price", "Total"]];
      document.querySelectorAll("#invoiceBody tr").forEach(row => {
        const item = row.cells[0].querySelector("input").value;
        const qty = row.cells[1].querySelector("input").value;
        const price = row.cells[2].querySelector("input").value;
        const total = row.cells[3].textContent;
        ws_data.push([item, qty, price, total]);
      });
      const subtotal = document.getElementById("subtotal").textContent;
      const totalWithTax = document.getElementById("totalWithTax").textContent;
      ws_data.push(["", "", "Subtotal", subtotal]);
      ws_data.push(["", "", "Total (with Tax)", totalWithTax]);
      const ws = XLSX.utils.aoa_to_sheet(ws_data);
      XLSX.utils.book_append_sheet(wb, ws, "Invoice");
      XLSX.writeFile(wb, "QuickBill_Invoice.xlsx");
    }

    async function downloadPDF() {
      calculateTotals();
      const pdf = new jspdf.jsPDF();
      const invoiceArea = document.body;
      await html2canvas(invoiceArea).then(canvas => {
        const imgData = canvas.toDataURL('image/png');
        const imgProps = pdf.getImageProperties(imgData);
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
        pdf.save("QuickBill_Invoice.pdf");
      });
    }

    calculateTotals();
  </script>

</body>
</html>
